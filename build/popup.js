function findHighResIcons(){let t=[];var e=document.querySelector('link[rel="manifest"]');e&&t.push({url:e.href,type:"manifest"}),document.querySelectorAll('link[rel*="icon"]').forEach(e=>{t.push({url:e.href,size:e.sizes?e.sizes.value:null,type:e.rel})});document.querySelectorAll('link[rel="apple-touch-icon"], link[rel="apple-touch-icon-precomposed"]').forEach(e=>{t.push({url:e.href,size:e.sizes?e.sizes.value:null,type:"apple-touch-icon"})});e=document.querySelector('meta[property="og:image"]');return e&&t.push({url:e.content,type:"og:image"}),t}document.addEventListener("DOMContentLoaded",function(){chrome.tabs.query({},function(e){let l=document.getElementById("tabList");e.forEach(t=>{var e=document.createElement("div"),n=(e.className="tab-item",document.createElement("img")),a=(n.className="tab-icon",n.src=t.favIconUrl||"images/default-icon.png",document.createElement("span")),o=(a.className="tab-title",a.textContent=t.title,document.createElement("button"));o.className="view-icon-btn",o.textContent="查看图标",o.onclick=function(){chrome.scripting.executeScript({target:{tabId:t.id},function:findHighResIcons},e=>{if(e&&e[0]&&e[0].result){e=e[0].result;if(0<e.length){let t=document.createElement("dialog");t.className="icon-dialog";var o=document.createElement("div"),l=(o.className="dialog-header",document.createElement("h3")),c=(l.textContent="可用图标列表",l.style.margin="3px 0",document.createElement("div")),r=(c.className="button-group",document.createElement("button")),r=(r.textContent="关闭",r.className="close-btn",r.onclick=e=>{e.preventDefault(),e.stopPropagation(),t.remove()},c.appendChild(r),o.appendChild(l),o.appendChild(c),t.appendChild(o),document.createElement("div"));r.className="dialog-content";let n=document.createElement("div");n.className="loading-container";l=document.createElement("div"),c=(l.className="spinner",document.createElement("p"));c.textContent="加载中...",n.appendChild(l),n.appendChild(c),r.appendChild(n);let a=document.createElement("div");a.className="icons-container",r.appendChild(a),t.appendChild(r),document.body.appendChild(t),t.showModal(),t.addEventListener("click",e=>{e.target===t&&t.remove()}),Promise.all(e.map(o=>fetch(o.url).then(e=>{if(e.ok)return e;throw new Error("Network response was not ok")}).then(()=>{var e=document.createElement("div");e.className="icon-container",e.onclick=e=>{e.stopPropagation()};let t=document.createElement("img");t.src=o.url,t.onclick=e=>{e.stopPropagation(),window.open(o.url,"_blank")},t.onload=()=>{t.classList.add("loaded")};var n=[],a=(o.type&&n.push(o.type),o.size&&n.push(o.size+"x"+o.size),document.createElement("span")),n=(a.textContent=n.join(" - "),document.createElement("button"));return n.textContent="下载",n.className="download-btn",n.onclick=e=>{e.preventDefault(),e.stopPropagation();e=document.createElement("a");e.href=o.url,e.download=`icon-${o.type||"unknown"}.png`,e.click()},e.appendChild(t),e.appendChild(a),e.appendChild(n),e}))).then(e=>{n.remove(),e.sort((e,t)=>{var n=e=>{var e=e.querySelector("span");return(e=e&&e.textContent.match(/\d+/))?parseInt(e[0]):-1},e=n(e),n=n(t);return-1===e&&-1===n?0:-1===e?1:-1===n?-1:n-e}),e.forEach(e=>{a.appendChild(e)})}).catch(e=>{n.remove();var t=document.createElement("div");t.textContent="加载图标时出现错误",t.style.textAlign="center",t.style.color="#666",t.style.padding="20px",a.appendChild(t)})}else{o=t.favIconUrl;o?window.open(o,"_blank"):alert("该页面没有图标！")}}})},e.appendChild(n),e.appendChild(a),e.appendChild(o),l.appendChild(e)})})});